<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="diaryMapper" >
 
 	<resultMap type="Diary" id="diaryResultMap">
 		<id property="diaryNo" column="DIARY_NO"/>
 		<result property="diaryTitle" column="DIARY_TITLE"/>
 		<result property="diaryContent" column="DIARY_CONTENT"/>
 		<result property="diaryStartDate" column="DIARY_STARTDATE"/>
 		<result property="diaryEndDate" column="DIARY_ENDDATE"/>
 		<result property="diaryUpdate" column="DIARY_UPDATE"/>
 		<result property="diaryColor" column="DIARY_COLOR"/>
 		<result property="diaryPicname" column="DIARY_PICNAME"/>
 		<result property="diaryRepicname" column="DIARY_REPICNAME"/>
		<result property="memberNo" column="MEMBER_NO"/>
 		<result property="companionNo" column="COMPANION_NO"/>
 		<result property="companionNick" column="COMPANION_NICK"/>
 	</resultMap>
 	<resultMap type="Guestbook" id="guestbookResultMap">
 		<id property="guestbookNo" column="GUESTBOOK_NO"/>
 		<result property="guestbookContent" column="GUESTBOOK_CONTENT"/>
 		<result property="guestbookDate" column="GUESTBOOK_DATE"/>
 		<result property="guestbookUpdate" column="GUESTBOOK_UPDATE"/>
 		<result property="memberNo" column="MEMBER_NO"/>
 		<result property="memberDiary" column="MEMBER_DIARY"/>
 		<result property="memberNick" column="MEMBER_NICK" />
 	</resultMap>
 	
 	<select id="selectAllDairy" resultType="CalendarView">
 		SELECT DIARY_NO,DIARY_TITLE AS "title",DIARY_CONTENT AS "constraint",DIARY_STARTDATE AS "start",DIARY_ENDDATE AS "end",DIARY_UPDATE,DIARY_COLOR AS "color",DIARY_PICNAME,DIARY_REPICNAME,D.MEMBER_NO,C.COMPANION_NICK FROM DIARY D JOIN COMPANION C USING (COMPANION_NO) WHERE D.MEMBER_NO = #{memberNo}
 	</select>
 	
 	<select id="selectOneDiary" parameterType="Diary" resultMap="diaryResultMap">
 		SELECT * FROM DIARY WHERE DIARY_NO = #{diaryNo}
 	</select>
 	
 <!-- 	<select id="selectAllCompanion" parameterType="Companion" resultMap="">
 		SELECT * FROM COMPANION WHERE MEMBER_NO = #{memberNo}
 	</select>
 	
	<select id="selectOneWaterDay" parameterType="WaterDay" resultMap="waterDayResultMap">

	</select>
 -->
	<select id="selectGuestbookList" parameterType="Guestbook" resultMap="guestbookResultMap">
		SELECT GUESTBOOK_NO, GUESTBOOK_CONTENT, GUESTBOOK_DATE, GUESTBOOK_UPDATE, MEMBER_NO, MEMBER_NICK ,MEMBER_DIARY 
		FROM GUESTBOOK JOIN MEMBER USING(MEMBER_NO) WHERE MEMBER_DIARY = #{memberDiary} ORDER BY GUESTBOOK_DATE DESC
	</select>
	
	
	<insert id="insertDiary" useGeneratedKeys="true" keyProperty="diaryNo" keyColumn="DIARY_NO">
		INSERT INTO DIARY VALUES (SEQ_DIARY.NEXTVAL,#{diaryTitle},#{diaryContent},#{diaryStartDate},#{diaryStartDate},NULL,#{diaryColor},#{diaryPicname},#{diaryRepicname},#{memberNo},#{companionNo})
	</insert>
	
	<update id="updateDiary">
		UPDATE DIARY SET 
		DIARY_TITLE = #{diaryTitle},DIARY_CONTENT=#{diaryContent},DIARY_STARTDATE=#{diaryStartDate},DIARY_ENDDATE=#{diaryStartDate},DIARY_UPDATE= SYSDATE,DIARY_COLOR=#{diaryColor},DIARY_PICNAME=#{diaryPicname},DIARY_REPICNAME=#{diaryRepicname} WHERE DIARY_NO = #{diaryNo}
	</update>
	
	<delete id="deleteDiary">
		DELETE FROM DIARY WHERE DIARY_NO = #{diaryNo}
	</delete>
	
	<update id="updateWaterDay">
		
	</update>
	
	<insert id="insertGuestbook">
		INSERT INTO GUESTBOOK 
		VALUES (SEQ_GUESTBOOK.NEXTVAL, #{guestbookContent},#{diaryPicname},#{diaryRepicname},#{memberNo},#{memberDiary})
	</insert>
	
	<update id="updateGuestbook">
		UPDATE GUESTBOOK SET GUESTBOOK_CONTENT = #{guestbookContent},GUESTBOOK_UPDATE = SYSDATE WHERE GUESTBOOK_NO = #{guestbookNo}
	</update>
	
	<delete id="deleteGuestbook">
		DELETE FROM GUESTBOOK WHERE GUESTBOOK_NO = #{guestbookNo}
	</delete>

 </mapper>